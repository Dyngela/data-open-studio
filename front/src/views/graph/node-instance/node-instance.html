<div
  class="node-instance"
  [attr.data-node-id]="node().id"
  [style.border-color]="node().type.color"
>
  <div class="node-header" [style.background-color]="node().type.color">
    <!-- Flow Input Port -->
    <div class="flow-input-ports">
      @for (portIndex of getFlowInputPorts(); track portIndex) {
        <div
          class="port input-port flow-port"
          [attr.data-node-id]="node().id"
          [attr.data-port-index]="portIndex"
          [attr.data-port-type]="PortType.FLOW"
          title="Flow Input {{ portIndex }}"
          (click)="onInputPortClick(portIndex, PortType.FLOW, $event)"
        ></div>
      }
    </div>

    <i [class]="headerIcon()"></i>
    <span class="node-title">{{ node().name || node().type.label }}</span>

    @if (dbName(); as name) {
      <span class="db-badge" title="Base connectÃ©e">DB: {{ name }}</span>
    }

    <!-- Flow Output Port -->
    <div class="flow-output-ports">
      @for (portIndex of getFlowOutputPorts(); track portIndex) {
        <div
          class="port output-port flow-port"
          [attr.data-node-id]="node().id"
          [attr.data-port-index]="portIndex"
          [attr.data-port-type]="PortType.FLOW"
          title="Flow Output {{ portIndex }}"
          (click)="onOutputPortClick(portIndex, PortType.FLOW, $event)"
        ></div>
      }
    </div>
  </div>

  <div class="node-body">
    <div class="ports-container">
      <div class="input-ports">
        @for (portIndex of getDataInputPorts(); track portIndex) {
          <div
            class="port input-port data-port"
            [attr.data-node-id]="node().id"
            [attr.data-port-index]="portIndex"
            [attr.data-port-type]="PortType.DATA"
            title="Data Input {{ portIndex }}"
            (click)="onInputPortClick(portIndex, PortType.DATA, $event)"
          ></div>
        }
      </div>

      <div class="output-ports">
        @for (portIndex of getDataOutputPorts(); track portIndex) {
          <div
            class="port output-port data-port"
            [attr.data-node-id]="node().id"
            [attr.data-port-index]="portIndex"
            [attr.data-port-type]="PortType.DATA"
            title="Data Output {{ portIndex }}"
            (click)="onOutputPortClick(portIndex, PortType.DATA, $event)"
          ></div>
        }
      </div>
    </div>

    @switch (node().type.id) {
      @case ('db-input') {
        <app-db-input-canvas [node]="node()" />
      }
      @case ('transform') {
        <app-map-canvas [node]="node()" />
      }
      @case ('log') {
        <app-log-canvas [node]="node()" />
      }
      @case ('output') {
        <app-output-canvas [node]="node()" />
      }
    }
  </div>
</div>
